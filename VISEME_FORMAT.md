# VISEME Code Reference

## Issue Fixed: welcome.json Format

The `welcome.json` file was using full viseme names (like `viseme_sil`, `viseme_DD`) instead of the letter codes that Avatar.jsx expects.

---

## ‚úÖ Correct Format

The Avatar component uses **single letter codes** (A-H, X) which map to Three.js morph target names:

### Letter Code Mapping (from Avatar.jsx)

```javascript
const corresponding = {
  A: "viseme_PP", // Lips together (P, B, M sounds)
  B: "viseme_kk", // Tongue up (K, G sounds)
  C: "viseme_I", // Smile (EE, I sounds)
  D: "viseme_AA", // Open mouth (AH, A sounds)
  E: "viseme_O", // Rounded (O, OH sounds)
  F: "viseme_U", // Narrow (OO, U sounds)
  G: "viseme_FF", // Teeth on lip (F, V sounds)
  H: "viseme_TH", // Tongue between teeth (TH sounds)
  X: "viseme_PP", // Silence/neutral
};
```

---

## üìù JSON File Format

Your VISEME JSON files should look like this:

```json
{
  "metadata": {
    "soundFile": "welcome.mp3",
    "duration": 5.92
  },
  "mouthCues": [
    {
      "start": 0,
      "end": 0.12,
      "value": "X"     ‚Üê Single letter code!
    },
    {
      "start": 0.14,
      "end": 0.29,
      "value": "B"     ‚Üê Not "viseme_kk"
    }
  ]
}
```

---

## üîß Common Conversions

When generating VISEME files, use these conversions:

| Full Viseme Name          | Letter Code | Sound   |
| ------------------------- | ----------- | ------- |
| `viseme_sil`              | `X`         | Silence |
| `viseme_PP`               | `A`         | P, B, M |
| `viseme_kk`               | `B`         | K, G, N |
| `viseme_I`                | `C`         | EE, I   |
| `viseme_AA` / `viseme_aa` | `D`         | AH, A   |
| `viseme_O` / `viseme_E`   | `E`         | O, OH   |
| `viseme_U`                | `F`         | OO, U   |
| `viseme_FF`               | `G`         | F, V    |
| `viseme_TH`               | `H`         | TH      |
| `viseme_DD` / `viseme_nn` | `B`         | D, T, N |

---

## üéØ Fixed Files

- ‚úÖ `frontend/public/audios/welcome.json` - Converted to letter codes
- ‚úÖ `frontend/public/audios/pizzas.json` - Already using correct format

---

## üõ†Ô∏è Tools Folder

If you're using the `tools/` folder to generate VISEME files, make sure it outputs the **letter codes (A-H, X)** format, not the full viseme names.

---

## Testing

After this fix:

1. Open the app: http://localhost:3000
2. Open browser console (F12)
3. Enable Leva controls (should appear in top-right)
4. Toggle "playAudio" to true
5. Select "welcome" in script dropdown
6. **The avatar mouth should now move!**

---

## Why This Happened

The `welcome.json` file was likely generated by a different tool or manually created with full viseme names. The Avatar.jsx component expects the simplified letter code format for performance and simplicity.
